<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tagtools">
<title>Rotation test • tagtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rotation test">
<meta property="og:description" content="tagtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tagtools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/acceleration-filtering.html">Complementary filtering for acceleration: low- &amp; high-frequency</a>
    <a class="dropdown-item" href="../articles/data-quality-error-correction.html">Data quality &amp; error correction</a>
    <a class="dropdown-item" href="../articles/detectors.html">Detectors</a>
    <a class="dropdown-item" href="../articles/dive-stats.html">Using dive_stats</a>
    <a class="dropdown-item" href="../articles/find-dives.html">Using find_dives</a>
    <a class="dropdown-item" href="../articles/fine-scale-tracking.html">Fine-scale tracking</a>
    <a class="dropdown-item" href="../articles/install-load-tagtools.html">Installing and loading tagtools</a>
    <a class="dropdown-item" href="../articles/jerk-transients.html">Jerk: a way to emphasize rapid changes in acceleration</a>
    <a class="dropdown-item" href="../articles/load-tag-data.html">Load tag data</a>
    <a class="dropdown-item" href="../articles/magnetometer-filtering.html">More complementary filtering: magnetometer &amp; dynamic acceleration</a>
    <a class="dropdown-item" href="../articles/mahalanobis-distance.html">Mahalanobis distance</a>
    <a class="dropdown-item" href="../articles/plots-and-cropping.html">Plots and cropping</a>
    <a class="dropdown-item" href="../articles/rotation-test.html">Rotation test</a>
    <a class="dropdown-item" href="../articles/tag-to-whale-frame.html">Tag orientation: From tag frame to sperm whale frame</a>
    <a class="dropdown-item" href="../articles/TagTools.html">Tagtools vignettes: overview and introduction</a>
    <a class="dropdown-item" href="../articles/vectors-vs-structures.html">Vectors and scalars versus structures</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Rotation test</h1>
                        <h4 data-toc-skip class="author">tagtools
project team</h4>
            
            <h4 data-toc-skip class="date">2023-06-23</h4>
      
      
      <div class="d-none name"><code>rotation-test.Rmd</code></div>
    </div>

    
    
<p>Welcome to the <code>rotation-test</code> vignette! Thanks for
getting to know our package. We hope this dataset revives a sense of
wonder somewhere in your soul. In this vignette, you will use a rotation
test to test whether a certain hypothesis is actually meaningfully
true.</p>
<p><em>Estimated time for this vignette: 20 minutes.</em></p>
<p>These practicals all assume that you have R/Rstudio, some basic
experience working with them, and can execute provided code, making some
user-specific changes along the way (e.g. to help R find a file you
downloaded). We will provide you with quite a few lines. To boost your
own learning, you would do well to try and write them before opening
what we give, using this just to check your work.</p>
<p>Additionally, be careful when copy-pasting special characters such as
_underscores_ and ‘quotes’. If you get an error, one thing to check is
that you have just a single, simple underscore, and
<code>'straight quotes'</code>, whether <code>'single'</code> or
<code>"double"</code> (rather than “smart quotes”).</p>
<div class="section level2">
<h2 id="rotation-test">Rotation test<a class="anchor" aria-label="anchor" href="#rotation-test"></a>
</h2>
<p>We were very fortunate to obtain a number of test datasets from
different sources that we have permission to make publicly available
with the tag tool kit. One dataset (obtained from anonymous Scottish
contacts) is particularly exciting and possibly unique in the world: a
fragment of tag data obtained from a high-resolution movement tag
deployed on Nessie, the Loch Ness Monster.</p>
<p>Unfortunately several of the tag sensors malfunctioned, but we were
able to salvage some dive depth data to be used in this example. The
dataset is called <code>nessie.nc</code>. If you want to run this
example, download the “nessie.nc” file from <a href="https://github.com/animaltags/tagtools_data" class="external-link uri">https://github.com/animaltags/tagtools_data</a> and change
the file path to match where you’ve saved the files</p>
<ol style="list-style-type: decimal">
<li>Read in the data:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tagtools</span><span class="op">)</span></span>
<span><span class="va">nessie_file_path</span> <span class="op">&lt;-</span> <span class="st">"nc_files/nessie.nc"</span></span>
<span><span class="va">nessie</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span><span class="va">nessie_file_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">nessie</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#load_nessie_nc">
Show/Hide Results
</button>
<div id="load_nessie_nc" class="collapse">
<pre><code><span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ P   :List of 16</span></span>
<span><span class="co">#&gt;  $ info:List of 17</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "animaltag" "list"</span></span></code></pre>
</div>
<p>And make a plot of the dive profile (because of course you want to
see it):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Depth <span class="op">=</span> <span class="va">nessie</span><span class="op">$</span><span class="va">P</span><span class="op">)</span>, interactive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#plot_nessie_profile">
Show/Hide Results
</button>
<div id="plot_nessie_profile" class="collapse">
<p><img src="rotation-test_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>According to some Scottish lore, Nessie surfaces more often in the
hour around noon than during the rest of the day (because the glare on
the water, and the lure of lunch, make it more difficult for people to
spot her then). But does she really? Use find_dives to find start times
for all her submergences, which we will use as a proxy for breath times.
In this case, you will want to use a threshold that is as shallow as
practicable.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">th</span> <span class="op">&lt;-</span> <span class="co"># ??? set a very shallow threshold</span></span>
<span><span class="co">#find dives</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_dives.html">find_dives</a></span><span class="op">(</span><span class="va">nessie</span><span class="op">$</span><span class="va">P</span>, mindepth <span class="op">=</span> <span class="va">th</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dt</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#find_dives_nessie">
Show/Hide Results
</button>
<div id="find_dives_nessie" class="collapse">
<pre><code><span><span class="co">#&gt; 'data.frame':    3471 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ start: num  0.52 0.64 0.84 1.2 1.48 1.6 1.76 1.88 2.12 2.24 ...</span></span>
<span><span class="co">#&gt;  $ end  : num  0.6 0.72 0.92 1.28 1.56 1.68 1.84 1.96 2.2 2.32 ...</span></span>
<span><span class="co">#&gt;  $ max  : num  0.601 0.606 0.622 0.615 0.615 ...</span></span>
<span><span class="co">#&gt;  $ tmax : num  0.6 0.72 0.92 1.28 1.56 1.68 1.84 1.96 2.2 2.32 ...</span></span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Do you think you could just use a regression model for surfacing
rate to answer this question? Why or why not?</li>
</ol>
<button class="btn btn-primary" data-toggle="collapse" data-target="#ans_noregr_nessie">
<em>Show/Hide Answers</em>
</button>
<div id="ans_noregr_nessie" class="collapse">
<p><em>No, because the data is autocorrelated? Uh,… because it’s just
more complicated?</em> <strong>help pls</strong></p>
</div>
<ol start="4" style="list-style-type: decimal">
<li>Use a rotation test to test whether the number of surfacings between
11:30 and 12:30 is actually higher than you’d expect.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make time variables</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">nessie</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">dephist_device_datetime_start</span>, tz <span class="op">=</span> <span class="st">'GMT'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nessie</span><span class="op">$</span><span class="va">P</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">nessie</span><span class="op">$</span><span class="va">P</span><span class="op">$</span><span class="va">sampling_rate</span></span>
<span><span class="co"># find data times between 11:30 and 12:30</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">'2017-01-13 11:30:00'</span>, tz <span class="op">=</span> <span class="st">'GMT'</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">'2017-01-13 12:30:00'</span>, tz <span class="op">=</span> <span class="st">'GMT'</span><span class="op">)</span></span>
<span><span class="va">noon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="va">e</span> <span class="op">&amp;</span> <span class="va">t</span> <span class="op">&gt;</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#convert to seconds</span></span>
<span><span class="va">noon</span> <span class="op">&lt;-</span> <span class="va">noon</span><span class="op">/</span><span class="va">nessie</span><span class="op">$</span><span class="va">P</span><span class="op">$</span><span class="va">sampling_rate</span></span>
<span><span class="co">#do test</span></span>
<span><span class="va">RTR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotation_test.html">rotation_test</a></span><span class="op">(</span>event_times <span class="op">=</span> <span class="va">dt</span><span class="op">$</span><span class="va">start</span>, exp_period <span class="op">=</span> <span class="va">noon</span>, full_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nessie</span><span class="op">$</span><span class="va">P</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">/</span><span class="va">nessie</span><span class="op">$</span><span class="va">P</span><span class="op">$</span><span class="va">sampling_rate</span><span class="op">)</span>, n_rot <span class="op">=</span> <span class="fl">10000</span>, ts_fun <span class="op">=</span> <span class="va">length</span><span class="op">)</span></span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#RTR">
Show/Hide Results
</button>
<div id="RTR" class="collapse">
<pre><code><span><span class="co">#&gt; $result</span></span>
<span><span class="co">#&gt;   statistic CI_low   CI_up n_rot conf_level   p_value</span></span>
<span><span class="co">#&gt; 1       153      0 855.025 10000       0.95 0.7427257</span></span></code></pre>
</div>
<!-- In Matlab: -->
<!--```
nessie = load_nc('nessie.nc');

% make time variable
st = datenum(info.dephist_device_datetime_start) + ...[1:length(P.data)]./P.sampling_rate/3600/24 ;
% find data times between 11:30 and 12:30
s = datenum( 2017-01-13 11:30:00 );
e = datenum( 2017-01-13 12:30:00 );
[st,et] = bounds(find(t < e & t > s));
% convert to seconds
st = st/P.sampling_rate;
et = et/P.sampling_rate;
% find dives
dt = find_dives(P, th);
% do test
RTR = rotation_test(dt.start,[st,et], ...[0,length(P.data)/P.sampling_rate],...100000, length , [],[],[]);
``` -->
<ol start="5" style="list-style-type: decimal">
<li>What can you conclude?</li>
</ol>
<button class="btn btn-primary" data-toggle="collapse" data-target="#ans_byebye_nessie">
<em>Show/Hide Answers</em>
</button>
<div id="ans_byebye_nessie" class="collapse">
<p><em>Since the p-value is so high, it appears that Nessie does not,
contrary to popular belief, actually surface (significantly) more in the
hour between 11:30am and 12:30pm.</em></p>
</div>
<p>And with that, great work! Now some of the mystery is forever gone…
but knowledge is power!</p>
<p><em>If you’d like to continue working through these practicals,
consider <code>dive-stats</code>.</em></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">'dive-stats'</span><span class="op">)</span></span></code></pre></div>
<hr>
<p>Animaltags home pages: <a href="http://animaltags.org/" class="external-link uri">http://animaltags.org/</a> (old), <a href="https://animaltags.netlify.app/" class="external-link uri">https://animaltags.netlify.app/</a> (new), <a href="https://github.com/stacyderuiter/TagTools" class="external-link uri">https://github.com/stacyderuiter/TagTools</a> (for latest
beta source code), <a href="https://stacyderuiter.github.io/TagTools/articles/TagTools" class="external-link uri">https://stacyderuiter.github.io/TagTools/articles/TagTools</a>
(vignettes overview)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stacy DeRuiter, Mark Johnson, David Sweeney, Ye Joo McNamara-Oh, Samuel Fynewever, (Oghenkevwe) Racheal Tejevbo, Tiago Marques, (Yuqian) Eason Wang, (Oghenesuvwe) Su Ogedegbe.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
